<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <style>
    body { font-family: DejaVu Sans, Arial, sans-serif; font-size:12px; color:#222; }
    .header { position: relative; margin-bottom: 100px; }
    .header-left { max-width: 50%; }
    .header-left h2 { margin: 0 0 10px 0; }
    .header-right { position: absolute; top: 0; right: 0; text-align: right; }
    .header-right img { width: 156px; height: auto; display: block; margin-left: auto; margin-right: 0; margin-bottom: 20px; }
    .atelier-info { text-align: right; font-size: 12px; line-height: 1.3; margin: 0; }
    .client { margin-bottom:12px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#f5f5f5; }
    .totals { margin-top:12px; float:right; width:300px; }
    .small { font-size:11px; color:#666; }
  </style>
</head>
<body>
  <table style="width: 100%; border: none; margin-bottom: 20px;">
    <tr>
      <td style="width: 50%; vertical-align: top; border: none; padding: 0;">
        <h2 style="margin: 0 0 10px 0;">Facture</h2>
        <div>N°: {{ facture.numero }}</div>
        <div>Date: {{ facture.created_at|default("N/A") }}</div>
      </td>
      <td style="width: 50%; vertical-align: top; border: none; padding: 0;">
        <div style="text-align: right;">
          {% if company.logo_path_for_pdf %}
            <img src="{{ company.logo_path_for_pdf }}" alt="{{ company.name }}" style="width: 156px; height: auto; margin-top: -15px; margin-bottom: 20px;">
          {% else %}
            <img src="img/logo_header_small.png" alt="Atelier Vélo" style="width: 156px; height: auto; margin-top: -15px; margin-bottom: 20px;">
          {% endif %}
        </div>
        <div style="text-align: right; font-size: 12px; line-height: 1.3; margin-top: 15px; width: 100%;">
          <strong>{{ company.name }}</strong><br>
          {{ company.address_line1 }}<br>
          {% if company.address_line2 %}{{ company.address_line2 }}<br>{% endif %}
          {{ company.postcode }} {{ company.city }}<br>
          {{ company.phone }}
          {% if company.email %}<br>{{ company.email }}{% endif %}
        </div>
      </td>
    </tr>
  </table>

  <div class="client">
    <strong>Client :</strong><br>
    {{ client.name }}<br>
    {{ client.address }}<br>
    {{ client.email }}
  </div>

  <table>
    <thead>
      <tr><th>Libellé</th><th>Qté</th><th>Prix</th><th>Total</th></tr>
    </thead>
    <tbody>
      {% for line in facture.lines|default([]) %}
        <tr>
          <td>{{ line.label }}</td>
          <td>{{ line.quantite }}</td>
          <td>{{ line.prix_ht_snapshot|number_format(2, ',', ' ') }}</td>
          <td>{{ (line.prix_ht_snapshot * line.quantite)|number_format(2, ',', ' ') }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="totals">
    <div style="font-size:1.1rem; margin-top:8px;"><strong>TOTAL:</strong> {{ facture.montant_ttc|default('0') }} €</div>
    {% if payment %}
      {% set pm = payment.method == 'CB' ? 'Carte bancaire' : 'Espèces' %}
      <div class="small" style="margin-top:6px;">
        Règlement: <strong>{{ pm }}</strong>{% if payment.paid_at %} — Payé le {{ payment.paid_at }}{% endif %}
      </div>
    {% endif %}
  </div>

</body>
</html>
